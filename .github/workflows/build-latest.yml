name: C/C++ CI

on:
  workflow_dispatch:

jobs:
  windows-build:
    runs-on: windows-latest
    steps:
    
    - name: Checkout Repository
      uses: actions/checkout@v4

    
    - name: Set Up MSVC Environment
      uses: ilammy/msvc-dev-cmd@v1

    
    - name: Configure CMake
      run: |
        cmake -S . -B build -G "Ninja" -DCMAKE_CXX_COMPILER=cl -DCMAKE_C_COMPILER=cl -DCMAKE_CXX_STANDARD=23 -DCMAKE_BUILD_TYPE=Release

    
    - name: Build DLL
      run: |
          cmake --build build
    - name: Upload a Build Artifact
      uses: actions/upload-artifact@v4.6.1
      with:
        name: Flarial DLL
        path: D:\a\dll\dll\build\Flarial.dll
                
    
    - name: Upload to CDN
      uses: cpina/github-action-push-to-another-repository@main
      env:
         
          # Way 2: using SSH deploy keys
          # @see https://cpina.github.io/push-to-another-repository-docs/setup-using-ssh-deploy-keys.html#setup-ssh-deploy-keys
          
         
          
        SSH_DEPLOY_KEY: ${{ secrets.DEPLOY_PRIVATE_KEY }}

      with:
          # GitHub Action output files
          source-directory: D:\a\dll\dll\build\
          destination-github-username: "TTF-fog"
          destination-repository-name: "newcdn"
          user-email: "ttf431@proton.me"
          

    - name: Test get variable exported by push-to-another-repository
      run: echo $DESTINATION_CLONED_DIRECTORY
